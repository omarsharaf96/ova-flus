#!/usr/bin/env bash
set -e

# Ensure Rust toolchain is on PATH
export PATH="$HOME/.cargo/bin:$PATH"

# Check if any Rust files in apps/backend are staged
RUST_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep '^apps/backend/' || true)

if [ -z "$RUST_FILES" ]; then
  exit 0
fi

echo "ü¶Ä Running Rust linting..."

cd apps/backend

echo "  ‚Üí cargo fmt --check"
cargo fmt --check || {
  echo ""
  echo "‚ùå Rust formatting check failed. Run 'cargo fmt' in apps/backend to fix."
  exit 1
}

echo "  ‚Üí cargo clippy"
cargo clippy -- -D warnings || {
  echo ""
  echo "‚ùå Clippy linting failed. Fix the warnings above before committing."
  exit 1
}

echo "‚úÖ Rust linting passed."
