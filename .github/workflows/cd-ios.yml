name: Deploy iOS

on:
  push:
    paths: ['apps/ios/**']

jobs:
  build:
    runs-on: macos-14
    steps:
      - uses: actions/checkout@v4
      - name: Build and Archive
        run: |
          cd apps/ios
          xcodebuild -scheme OvaFlus -configuration Release \
            -archivePath OvaFlus.xcarchive archive \
            CODE_SIGN_IDENTITY="" CODE_SIGNING_REQUIRED=NO
      - name: Export IPA
        run: |
          cd apps/ios
          xcodebuild -exportArchive -archivePath OvaFlus.xcarchive \
            -exportPath export -exportOptionsPlist ExportOptions.plist
      - name: Upload to TestFlight
        run: |
          xcrun altool --upload-app -f apps/ios/export/OvaFlus.ipa \
            --username ${{ secrets.APPLE_ID }} \
            --password ${{ secrets.APPLE_APP_PASSWORD }}
        continue-on-error: true
